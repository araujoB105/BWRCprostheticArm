define(["require","exports","spectrum_comments/comment_editor/reducers/macros/draft","spectrum_comments/comment_editor/reducers/macros/macro","spectrum_comments/comment_editor/macros/mentions_macro_composer","spectrum_comments/comment_editor/core/composer_wrappers","spectrum_comments/comment_editor/components/mention_suggestions_list","spectrum_comments/comment_editor/components/mention_decorator","spectrum_comments/comment_editor/draft_utils","draft-js"],function(e,t,n,o,r,i,s,c,a,m){"use strict";function u(e){var t=e.innerProps,n=t.text,o=t.offset,r=t.delimiter,i=t.input;if((o+i.length-r.length===0||" "===n.substr(o-r.length,1))&&n.substring(o-r.length+1,o)+i===r)return{start:o,end:o+r.length,text:i}}function d(e){var t=e.kernel.compose(u,e.innerProps);if(t)return t;var n=e.innerProps,o=n.text,r=n.delimiter,i=n.offset,s=n.input,c=o.substr(0,i).match(/[^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*$/);return null!==c?{start:i-c[0].length,end:i+r.length,text:c[0]+s}:void 0}function p(e){return Object.keys(e).map(function(t){var r=e[t],i=r.onMacro,s=void 0===i?function(){}:i,c=r.type,a=void 0===c?"macro: "+t:c,m=r.spanProps,d=void 0===m?{}:m,p=r.macroDecorators,l=void 0===p?[]:p,f=r.onAutoComplete,g=r.onDelimiter,v=void 0===g?u:g;return{draft:{values:n.createDraftValuesReducers(a,t,d,s,v,l)},macro:{evts:o.createMacroEventReducers(a,f),values:o.createMacroValuesReducers(a,s)}}})}function l(e){function t(e,t,n,i,c){var u=d.createEntity("mention","IMMUTABLE",{identifier:e,type:t}),p=u.getLastCreatedEntityKey(),l=a.replaceText(u,s.active.blockKey,i,c,n,p);r.draft.change(a.replaceContent(o.draft.editorState,m.Modifier.insertText(l,l.getSelectionAfter()," ")))}function n(e){return s.active.entityKey===e.getEntity()}var o=e.status,r=e.scopeTriggers,i=o.draft,s=o.macro,c=o.mentionSuggestions,u=o.suggestion,d=i.editorState.getCurrentContent(),p=d.getBlockForKey(s.active.blockKey);if(u.selectedIndex!==-1){var l=c.userMap[s.active.content],f=l[u.selectedIndex];f&&p.findEntityRanges(n,t.bind(null,f.id,"id",f.name.display))}else a.parseEmail(s.active.content)&&p.findEntityRanges(n,t.bind(null,s.active.content,"email",s.active.content))}Object.defineProperty(t,"__esModule",{value:!0});var f={strategy:function(e,t,n){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&"mention"===n.getEntity(t).getType()},t)},component:c.MentionDecorator};t.macrosReducers=function(e){var t=e.onMentionSuggestionsQuery;return p({"@":{onDelimiter:d,onMacro:i.bindComposer(r.mentionsMacroComposer,{onMentionSuggestionsQuery:t}),spanProps:{className:"active-mention",chrome:i.wrapComposerComponent(s.mentionSuggestionsListComposer)},macroDecorators:[f],onAutoComplete:l}})}});
//# sourceMappingURL=index.min.js-vflz2E9Wz.map